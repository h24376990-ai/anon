<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>暇チャット ログイン</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="register-container">
  <h1>ログイン</h1>
  <div class="subtitle">名前と合言葉でログイン</div>

  <input type="text" id="nameInput" placeholder="名前">
  <input type="password" id="passwordInput" placeholder="合言葉">
  <button id="loginBtn">ログイン</button>

  <p id="message"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase 設定
const firebaseConfig = {
  apiKey: "AIzaSyA0R2KYt2MgJHaiYQ9oM8IMXhX9oj-Ky_c",
  authDomain: "anon-chat-de585.firebaseapp.com",
  projectId: "anon-chat-de585",
  storageBucket: "anon-chat-de585.firebasestorage.app",
  messagingSenderId: "1035093625910",
  appId: "1:1035093625910:web:65ba2370a79f73e23b9c97"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const nameInput = document.getElementById("nameInput");
const passwordInput = document.getElementById("passwordInput");
const loginBtn = document.getElementById("loginBtn");
const message = document.getElementById("message");

loginBtn.onclick = async () => {
  const name = nameInput.value.trim();
  const password = passwordInput.value.trim();

  if (!name || !password) {
    message.textContent = "名前と合言葉を入力してください";
    return;
  }

  // users コレクションを検索
  const q = query(
    collection(db, "users"),
    where("name", "==", name),
    where("password", "==", password) // Firestore に password フィールドがある前提
  );

  const snap = await getDocs(q);

  if (snap.empty) {
    message.textContent = "ログインに失敗しました";
    return;
  }

  // ユーザー UID を取得して chat.html に遷移
  const userDoc = snap.docs[0];
  const uid = userDoc.id;

  location.href = `chat.html?uid=${uid}`;
};
</script>
</body>
</html>
